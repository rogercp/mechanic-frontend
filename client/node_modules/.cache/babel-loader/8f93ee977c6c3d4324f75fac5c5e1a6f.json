{"ast":null,"code":"var _jsxFileName = \"/Users/roger/Projects/mechanic-frontend/client/src/components/ProfileImageUpload.js\";\nimport React, { useState, useEffect } from 'react';\nimport { imagesRef } from '../helpers/firebase';\nimport axiosWithAuth from '../helpers/axiosWithAuth';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport CloudUploadIcon from '@material-ui/icons/CloudUpload';\nimport { connect } from 'react-redux';\nimport { fetchProfileImage } from \"../store/actions/settingsActions\";\nconst useStyles = makeStyles(theme => ({\n  button: {\n    margin: theme.spacing(1)\n  }\n}));\n\nfunction ProfileImageUpload(props) {\n  const classes = useStyles();\n  const [file, setFile] = useState({}); // \n\n  const [isLoading, setIsLoading] = useState(false);\n  const userId = localStorage.getItem('id'); // useEffect(() => {\n  //     props.fetchProfileImage(userId);\n  // }, [file]);\n  // async function fetchProfileImage() {\n  //     let userImages = await axiosWithAuth().get(`/users/image/${userId}`)\n  //     setUserImage(userImages.data);\n  //     return userImages;\n  // }\n\n  function handleInputChanges(e) {\n    e.preventDefault();\n    const file = e.target.files[0];\n\n    if (!file) {\n      return;\n    }\n\n    if (file && file.size > 1e8) {\n      alert(\"File is too large. Maximum limit is 100MB.\");\n      e.target.value = '';\n    } else {\n      setFile(file);\n    }\n  }\n\n  function handleSubmitUploaderProfilePicture(e) {\n    setIsLoading(true);\n    e.preventDefault(); // Create file ref for firebase\n\n    const fileRef = imagesRef.child(`${userId}/${file.name}`); // Upload file to google\n\n    fileRef.put(file).then(snapshot => {\n      // send reference to backend\n      axiosWithAuth().post(`/users/image/${userId}`, {\n        file_name: file.name\n      }).then(res => {\n        setIsLoading(true);\n        props.onClose();\n        props.fetchProfileImage(userId);\n      }).catch(error => {\n        console.error(error);\n      });\n    }).catch(err => {\n      console.error(err);\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      height: \"200px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 13\n    }\n  }, props.carFix ? /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 34\n    }\n  }, \"no image\") : null, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: 'flex',\n      flexDirection: \"column\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: handleSubmitUploaderProfilePicture,\n    style: {\n      display: 'flex',\n      flexDirection: \"column\",\n      maxWidth: \"200px\",\n      justifyContent: \"Center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 21\n    }\n  }, isLoading ? /*#__PURE__*/React.createElement(\"div\", {\n    class: \"spinner-border\",\n    role: \"status\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 26\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    class: \"sr-only\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 26\n    }\n  }, \"Loading...\")) : null, /*#__PURE__*/React.createElement(\"input\", {\n    required: true,\n    id: \"uploader\",\n    type: \"file\",\n    accept: \"image/*,.pdf,.doc\",\n    onChange: handleInputChanges,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 25\n    }\n  }), /*#__PURE__*/React.createElement(Button, {\n    variant: \"contained\",\n    name: \"car_type\",\n    color: \"default\",\n    className: classes.button,\n    startIcon: /*#__PURE__*/React.createElement(CloudUploadIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 40\n      }\n    }),\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 25\n    }\n  }, \"Upload\")))));\n}\n\nconst mapStateToProps = state => ({\n  userImage: state.setting.userImage\n});\n\nexport default connect(mapStateToProps, {\n  fetchProfileImage\n})(ProfileImageUpload);","map":{"version":3,"sources":["/Users/roger/Projects/mechanic-frontend/client/src/components/ProfileImageUpload.js"],"names":["React","useState","useEffect","imagesRef","axiosWithAuth","Button","makeStyles","CloudUploadIcon","connect","fetchProfileImage","useStyles","theme","button","margin","spacing","ProfileImageUpload","props","classes","file","setFile","isLoading","setIsLoading","userId","localStorage","getItem","handleInputChanges","e","preventDefault","target","files","size","alert","value","handleSubmitUploaderProfilePicture","fileRef","child","name","put","then","snapshot","post","file_name","res","onClose","catch","error","console","err","height","carFix","display","flexDirection","maxWidth","justifyContent","mapStateToProps","state","userImage","setting"],"mappings":"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","sourcesContent":["\nimport React, { useState,useEffect } from 'react';\nimport { imagesRef } from '../helpers/firebase';\nimport axiosWithAuth from '../helpers/axiosWithAuth';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport CloudUploadIcon from '@material-ui/icons/CloudUpload';\nimport { connect } from 'react-redux';\nimport { fetchProfileImage } from \"../store/actions/settingsActions\";\n\n\n\nconst useStyles = makeStyles(theme => ({\n    button: {\n        margin: theme.spacing(1),\n    },\n}));\n\nfunction ProfileImageUpload(props) {\n\n    const classes = useStyles();\n\n    const [file, setFile] = useState({});\n    // \n    const [isLoading,setIsLoading] = useState(false)\n    const userId = localStorage.getItem('id');\n\n    // useEffect(() => {\n\n    //     props.fetchProfileImage(userId);\n\n    // }, [file]);\n\n\n    // async function fetchProfileImage() {\n    //     let userImages = await axiosWithAuth().get(`/users/image/${userId}`)\n    //     setUserImage(userImages.data);\n    //     return userImages;\n    // }\n\n    function handleInputChanges(e) {\n        e.preventDefault();\n        const file = e.target.files[0]\n        if (!file) {\n            return;\n        }\n        if (file && file.size > 1e8) {\n            alert(\"File is too large. Maximum limit is 100MB.\")\n            e.target.value = ''\n        } else {\n            setFile(file);\n        }\n    }\n\n\n    function handleSubmitUploaderProfilePicture(e) {\n        setIsLoading(true)\n        e.preventDefault()\n          // Create file ref for firebase\n        const fileRef = imagesRef.child(`${userId}/${file.name}`)\n        // Upload file to google\n        fileRef.put(file).then((snapshot) => {\n            // send reference to backend\n            axiosWithAuth().post(`/users/image/${userId}`, { file_name: file.name })\n                .then(res => {\n                    setIsLoading(true)\n                    props.onClose()\n                    props.fetchProfileImage(userId);\n                    \n                })\n                .catch(error => {\n                    console.error(error);\n                })\n        }).catch(err => {\n            console.error(err)\n        });\n    }\n\n\n    return (\n        <>\n            <div style={{ height: \"200px\" }}>\n                {(props.carFix ? <p>no image</p> : null)}\n                <div style={{ display: 'flex', flexDirection: \"column\" }}>\n                    <form onSubmit={handleSubmitUploaderProfilePicture} style={{ display: 'flex', flexDirection: \"column\", maxWidth: \"200px\", justifyContent: \"Center\" }}>\n                        \n                    {isLoading ? \n                         <div class=\"spinner-border\" role=\"status\">\n                         <span class=\"sr-only\">Loading...</span>\n                         </div>\n                            :null}\n                        <input required id=\"uploader\" type=\"file\" accept=\"image/*,.pdf,.doc\" onChange={handleInputChanges}></input>\n                        <Button\n                            variant=\"contained\"\n                            name=\"car_type\"\n                            color=\"default\"\n                            className={classes.button}\n                            startIcon={<CloudUploadIcon />}\n                            type=\"submit\"\n                        >\n                            Upload\n                </Button>\n                    </form>\n                </div>\n            </div>\n        </>\n    )\n\n\n}\n\n\nconst mapStateToProps = state => ({\n    userImage: state.setting.userImage\n});\nexport default connect(\n    mapStateToProps,\n    { fetchProfileImage }\n)(ProfileImageUpload);\n\n"]},"metadata":{},"sourceType":"module"}