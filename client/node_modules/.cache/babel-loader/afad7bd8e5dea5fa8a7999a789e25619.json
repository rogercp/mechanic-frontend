{"ast":null,"code":"import _regeneratorRuntime from\"/Users/roger/Projects/mechanic-frontend/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/roger/Projects/mechanic-frontend/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/roger/Projects/mechanic-frontend/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{imagesRef}from'../helpers/firebase';import axiosWithAuth from'../helpers/axiosWithAuth';import Button from'@material-ui/core/Button';import{makeStyles}from'@material-ui/core/styles';import CloudUploadIcon from'@material-ui/icons/CloudUpload';import CarImgShow from'./CarImgShow';import CarImageFixShow from'./CarImageFixShow';import DriveEtaIcon from'@material-ui/icons/DriveEta';import ImageCarousel from'./ImageCarousel';import DescriptionIcon from'@material-ui/icons/Description';var useStyles=makeStyles(function(theme){return{button:{margin:theme.spacing(1)}};});function CarFixImgUpload(props){var classes=useStyles();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),carFixImages=_useState2[0],setCarFixImages=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),file=_useState4[0],setFile=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),fullopen=_useState6[0],setFullOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),errorOpen=_useState8[0],setErrorOpen=_useState8[1];var handlefullOpen=function handlefullOpen(){setFullOpen(true);};var handlefullClose=function handlefullClose(){setFullOpen(false);};function handleErrorClose(){setErrorOpen(false);}function handleErrorOpen(){setErrorOpen(true);}useEffect(function(){fetchFixDocuments();},[file]);function fetchFixDocuments(){return _fetchFixDocuments.apply(this,arguments);}function _fetchFixDocuments(){_fetchFixDocuments=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var fixImages;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axiosWithAuth().get(\"/car_fix/\".concat(props.carFix.id,\"/car_fix_images\"));case 2:fixImages=_context.sent;setCarFixImages(fixImages.data);return _context.abrupt(\"return\",fixImages);case 5:case\"end\":return _context.stop();}}},_callee);}));return _fetchFixDocuments.apply(this,arguments);}function handleInputChanges(e){e.preventDefault();var file=e.target.files[0];if(!file){return;}if(file&&file.size>1e8){alert(\"File is too large. Maximum limit is 100MB.\");e.target.value='';}else{setFile(file);}}function handleSubmitUploaderFixDocuments(e){e.preventDefault();// Create file ref (Example: /documents/:car_id/:file_name)\nvar fileRef=imagesRef.child(\"\".concat(props.carFix.id,\"/\").concat(file.name));// Upload file\nfileRef.put(file).then(function(snapshot){// console.log('Upload success!', snapshot.constructor, snapshot);\naxiosWithAuth().post(\"/car_fix/\".concat(props.carFix.id,\"/car_fix_images\"),{file_name:file.name}).then(function(res){fetchFixDocuments();window.location.reload();}).catch(function(error){console.error(error);});}).catch(function(err){console.error(err);});}if(carFixImages.length>0){return React.createElement(React.Fragment,null,React.createElement(Button,{style:{color:\"darkcyan\",outline:'0'},onClick:handlefullOpen},React.createElement(DescriptionIcon,null)),React.createElement(ImageCarousel,{open:fullopen,handleClose:handlefullClose,onClose:handlefullClose,carFixImages:carFixImages,carFix:props.carFix}),React.createElement(\"div\",{style:{height:\"200px\"}},React.createElement(\"div\",{style:{display:'flex',flexDirection:\"column\"}},React.createElement(\"form\",{onSubmit:handleSubmitUploaderFixDocuments},React.createElement(\"input\",{required:true,id:\"uploader\",type:\"file\",accept:\"image/*,.pdf,.doc\",onChange:handleInputChanges}),React.createElement(Button,{variant:\"contained\",name:\"car_type\",color:\"default\",className:classes.button,startIcon:React.createElement(CloudUploadIcon,null),type:\"submit\"},\"Upload\")))));}else{return React.createElement(React.Fragment,null,React.createElement(\"div\",{style:{height:\"200px\"}},props.carFix?React.createElement(DriveEtaIcon,{style:{fontSize:\"100px\"}}):null,React.createElement(\"div\",{style:{display:'flex',flexDirection:\"column\"}},React.createElement(\"form\",{onSubmit:handleSubmitUploaderFixDocuments},React.createElement(\"input\",{required:true,id:\"uploader\",type:\"file\",accept:\"image/*,.pdf,.doc\",onChange:handleInputChanges}),React.createElement(Button,{variant:\"contained\",name:\"car_type\",color:\"default\",className:classes.button,startIcon:React.createElement(CloudUploadIcon,null),type:\"submit\"},\"Upload\")))));}}export default CarFixImgUpload;","map":{"version":3,"sources":["/Users/roger/Projects/mechanic-frontend/client/src/components/CarFixImgUpload.js"],"names":["React","useEffect","useState","imagesRef","axiosWithAuth","Button","makeStyles","CloudUploadIcon","CarImgShow","CarImageFixShow","DriveEtaIcon","ImageCarousel","DescriptionIcon","useStyles","theme","button","margin","spacing","CarFixImgUpload","props","classes","carFixImages","setCarFixImages","file","setFile","fullopen","setFullOpen","errorOpen","setErrorOpen","handlefullOpen","handlefullClose","handleErrorClose","handleErrorOpen","fetchFixDocuments","get","carFix","id","fixImages","data","handleInputChanges","e","preventDefault","target","files","size","alert","value","handleSubmitUploaderFixDocuments","fileRef","child","name","put","then","snapshot","post","file_name","res","window","location","reload","catch","error","console","err","length","color","outline","height","display","flexDirection","fontSize"],"mappings":"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","sourcesContent":["\n\nimport React, { useEffect, useState } from 'react';\nimport { imagesRef } from '../helpers/firebase';\nimport axiosWithAuth from '../helpers/axiosWithAuth';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport CloudUploadIcon from '@material-ui/icons/CloudUpload';\nimport CarImgShow from './CarImgShow';\nimport CarImageFixShow from './CarImageFixShow';\nimport DriveEtaIcon from '@material-ui/icons/DriveEta';\nimport ImageCarousel from './ImageCarousel';\nimport DescriptionIcon from '@material-ui/icons/Description';\n\nconst useStyles = makeStyles(theme => ({\n    button: {\n      margin: theme.spacing(1),\n    },\n  }));\n\nfunction CarFixImgUpload(props) {\n\n    \n    const classes = useStyles();\n    const [carFixImages, setCarFixImages] = useState([]);\n    const [file, setFile] = useState({});\n\n    const [fullopen, setFullOpen] = useState(false);\n    const [errorOpen, setErrorOpen] = useState(false);\n\n\n    const handlefullOpen = () => {\n        setFullOpen(true);\n    };\n    const handlefullClose = () => {\n        setFullOpen(false);\n    };\n\n    function handleErrorClose() {\n        setErrorOpen(false);\n    }\n    \n    function handleErrorOpen() {\n        setErrorOpen(true);\n    }\n\n\n    useEffect(() => {\n    \n        fetchFixDocuments();\n        \n    }, [file]);\n\n    async function fetchFixDocuments() {\n        let fixImages = await axiosWithAuth().get(`/car_fix/${props.carFix.id}/car_fix_images`)\n        setCarFixImages(fixImages.data);\n        return fixImages;\n    }\n\n    function handleInputChanges(e) {\n        e.preventDefault();\n        const file = e.target.files[0]\n        if (!file) {\n            return;\n        }\n        if (file && file.size > 1e8) {\n            alert(\"File is too large. Maximum limit is 100MB.\")\n            e.target.value = ''\n        } else {\n            setFile(file);\n        }\n    }\n\n\n    function handleSubmitUploaderFixDocuments(e) {\n        e.preventDefault()\n        // Create file ref (Example: /documents/:car_id/:file_name)\n        const fileRef = imagesRef.child(`${props.carFix.id}/${file.name}`)\n        // Upload file\n        fileRef.put(file).then((snapshot) => {\n            // console.log('Upload success!', snapshot.constructor, snapshot);\n            axiosWithAuth().post(`/car_fix/${props.carFix.id}/car_fix_images`, { file_name: file.name })\n                .then(res => {\n                    fetchFixDocuments();\n                    window.location.reload();               \n                 })\n                .catch(error => {\n                    console.error(error);\n                })\n        }).catch(err => {\n            console.error(err)\n        });\n    }\n    \n\n\n   if(carFixImages.length > 0 ){\n        return (\n        <>\n\n                <Button\n                    style={{color:\"darkcyan\",  outline:'0'}}\n                            onClick={handlefullOpen}\n                        >\n\n                <DescriptionIcon/>\n                </Button>\n\n                <ImageCarousel\n                open={fullopen}\n                handleClose={handlefullClose}\n                onClose={handlefullClose}\n                carFixImages= {carFixImages}\n                carFix = {props.carFix}\n                />\n\n                <div style={{height:\"200px\"}}>\n                <div style={{display:'flex',flexDirection:\"column\"}}>\n                 <form onSubmit={handleSubmitUploaderFixDocuments}> \n                <input required id=\"uploader\" type=\"file\" accept=\"image/*,.pdf,.doc\" onChange={handleInputChanges}></input>\n                    <Button\n                    variant=\"contained\"\n                    name=\"car_type\"\n                    color=\"default\"\n                    className={classes.button}\n                    startIcon={<CloudUploadIcon />}\n                    type =\"submit\"\n                    >\n                    Upload\n                </Button>\n                </form>\n                </div>\n                </div>\n            \n        </>\n        )\n    }else{\n        return (\n            <>\n                <div style={{height:\"200px\"}}>\n                {(props.carFix ? <DriveEtaIcon style={{fontSize:\"100px\"}}/> : null)} \n                <div style={{display:'flex',flexDirection:\"column\"}}>\n                 <form onSubmit={handleSubmitUploaderFixDocuments}> \n                <input required id=\"uploader\" type=\"file\" accept=\"image/*,.pdf,.doc\" onChange={handleInputChanges}></input>\n                    <Button\n                    variant=\"contained\"\n                    name=\"car_type\"\n                    color=\"default\"\n                    className={classes.button}\n                    startIcon={<CloudUploadIcon />}\n                    type =\"submit\"\n                    >\n                    Upload\n                </Button>\n                </form>\n                </div>\n                </div>\n                \n            </>\n        )\n    }\n   \n        \n    \n}\n\n\n\nexport default CarFixImgUpload;\n"]},"metadata":{},"sourceType":"module"}