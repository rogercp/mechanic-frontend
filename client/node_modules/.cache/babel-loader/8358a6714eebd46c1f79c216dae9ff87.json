{"ast":null,"code":"import _regeneratorRuntime from\"/Users/roger/Projects/mechanic-frontend/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/roger/Projects/mechanic-frontend/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/roger/Projects/mechanic-frontend/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{imagesRef}from'../helpers/firebase';import axiosWithAuth from'../helpers/axiosWithAuth';import Button from'@material-ui/core/Button';import{makeStyles}from'@material-ui/core/styles';import CloudUploadIcon from'@material-ui/icons/CloudUpload';import CarImgShow from'./CarImgShow';import CarImageFixShow from'./CarImageFixShow';import DriveEtaIcon from'@material-ui/icons/DriveEta';var useStyles=makeStyles(function(theme){return{button:{margin:theme.spacing(1)}};});function CarImgUpload(props){var classes=useStyles();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),carImages=_useState2[0],setCarImages=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),carFixImages=_useState4[0],setCarFixImages=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),file=_useState6[0],setFile=_useState6[1];useEffect(function(){if(props.car){fetchCarImages();}if(props.carFix){fetchFixDocuments();}},[file]);function fetchCarImages(){return _fetchCarImages.apply(this,arguments);}function _fetchCarImages(){_fetchCarImages=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var images;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axiosWithAuth().get(\"/cars/\".concat(props.car.id,\"/images\"));case 2:images=_context.sent;setCarImages(images.data);return _context.abrupt(\"return\",images);case 5:case\"end\":return _context.stop();}}},_callee);}));return _fetchCarImages.apply(this,arguments);}function fetchFixDocuments(){return _fetchFixDocuments.apply(this,arguments);}function _fetchFixDocuments(){_fetchFixDocuments=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var fixImages;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axiosWithAuth().get(\"/car_fix/\".concat(props.carFix.id,\"/car_fix_images\"));case 2:fixImages=_context2.sent;setCarFixImages(fixImages.data);return _context2.abrupt(\"return\",fixImages);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return _fetchFixDocuments.apply(this,arguments);}function handleInputChanges(e){e.preventDefault();var file=e.target.files[0];if(!file){return;}if(file&&file.size>1e8){alert(\"File is too large. Maximum limit is 100MB.\");e.target.value='';}else{setFile(file);}}function handleSubmitUploader(e){e.preventDefault();// Create file ref (Example: /documents/:car_id/:file_name)\nvar fileRef=imagesRef.child(\"\".concat(props.car.id,\"/\").concat(file.name));// Upload file\nfileRef.put(file).then(function(snapshot){// console.log('Upload success!', snapshot.constructor, snapshot);\naxiosWithAuth().post(\"/cars/\".concat(props.car.id,\"/images\"),{file_name:file.name}).then(function(res){fetchCarImages();window.location.reload();}).catch(function(error){console.error(error);});}).catch(function(err){console.error(err);});}function handleSubmitUploaderFixDocuments(e){e.preventDefault();// Create file ref (Example: /documents/:car_id/:file_name)\nvar fileRef=imagesRef.child(\"\".concat(props.carFix.id,\"/\").concat(file.name));// Upload file\nfileRef.put(file).then(function(snapshot){// console.log('Upload success!', snapshot.constructor, snapshot);\naxiosWithAuth().post(\"/car_fix/\".concat(props.carFix.id,\"/car_fix_images\"),{file_name:file.name}).then(function(res){fetchFixDocuments();window.location.reload();}).catch(function(error){console.error(error);});}).catch(function(err){console.error(err);});}if(carImages.length>0){return React.createElement(React.Fragment,null,carImages.map(function(image,index){return React.createElement(CarImgShow,{key:index,car:props.car,image:image});}));}else if(carFixImages.length>0){return React.createElement(React.Fragment,null,carFixImages.map(function(image,index){return React.createElement(CarImageFixShow,{key:index,carFix:props.carFix,image:image});}));}else{return React.createElement(React.Fragment,null,React.createElement(\"div\",{style:{height:\"200px\"}},props.car?React.createElement(DriveEtaIcon,{style:{fontSize:\"100px\"}}):null,React.createElement(\"div\",{style:{display:'flex',flexDirection:\"column\"}},React.createElement(\"form\",{onSubmit:props.car?handleSubmitUploader:handleSubmitUploaderFixDocuments},React.createElement(\"input\",{required:true,id:\"uploader\",type:\"file\",accept:\"image/*,.pdf,.doc\",onChange:handleInputChanges}),React.createElement(Button,{variant:\"contained\",name:\"car_type\",color:\"default\",className:classes.button,startIcon:React.createElement(CloudUploadIcon,null),type:\"submit\"},\"Upload\")))));}}export default CarImgUpload;","map":{"version":3,"sources":["/Users/roger/Projects/mechanic-frontend/client/src/components/CarImgUpload.js"],"names":["React","useEffect","useState","imagesRef","axiosWithAuth","Button","makeStyles","CloudUploadIcon","CarImgShow","CarImageFixShow","DriveEtaIcon","useStyles","theme","button","margin","spacing","CarImgUpload","props","classes","carImages","setCarImages","carFixImages","setCarFixImages","file","setFile","car","fetchCarImages","carFix","fetchFixDocuments","get","id","images","data","fixImages","handleInputChanges","e","preventDefault","target","files","size","alert","value","handleSubmitUploader","fileRef","child","name","put","then","snapshot","post","file_name","res","window","location","reload","catch","error","console","err","handleSubmitUploaderFixDocuments","length","map","image","index","height","fontSize","display","flexDirection"],"mappings":"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","sourcesContent":["\nimport React, { useEffect, useState } from 'react';\nimport { imagesRef } from '../helpers/firebase';\nimport axiosWithAuth from '../helpers/axiosWithAuth';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport CloudUploadIcon from '@material-ui/icons/CloudUpload';\nimport CarImgShow from './CarImgShow';\nimport CarImageFixShow from './CarImageFixShow';\nimport DriveEtaIcon from '@material-ui/icons/DriveEta';\n\nconst useStyles = makeStyles(theme => ({\n    button: {\n      margin: theme.spacing(1),\n    },\n  }));\n\n\nfunction CarImgUpload(props) {\n\n    const classes = useStyles();\n    const [carImages, setCarImages] = useState([]);\n    const [carFixImages, setCarFixImages] = useState([]);\n    const [file, setFile] = useState({});\n\n    useEffect(() => {\n        if(props.car){\n        fetchCarImages();\n        }if(props.carFix){\n        fetchFixDocuments();\n        }\n    }, [file]);\n\n    async function fetchCarImages() {\n        let images = await axiosWithAuth().get(`/cars/${props.car.id}/images`)\n        setCarImages(images.data);\n        return images;\n    }\n\n    async function fetchFixDocuments() {\n        let fixImages = await axiosWithAuth().get(`/car_fix/${props.carFix.id}/car_fix_images`)\n        setCarFixImages(fixImages.data);\n        return fixImages;\n    }\n\n    function handleInputChanges(e) {\n        e.preventDefault();\n        const file = e.target.files[0]\n        if (!file) {\n            return;\n        }\n        if (file && file.size > 1e8) {\n            alert(\"File is too large. Maximum limit is 100MB.\")\n            e.target.value = ''\n        } else {\n            setFile(file);\n        }\n    }\n\n    function handleSubmitUploader(e) {\n        e.preventDefault()\n        // Create file ref (Example: /documents/:car_id/:file_name)\n        const fileRef = imagesRef.child(`${props.car.id}/${file.name}`)\n        // Upload file\n        fileRef.put(file).then((snapshot) => {\n            // console.log('Upload success!', snapshot.constructor, snapshot);\n            axiosWithAuth().post(`/cars/${props.car.id}/images`, { file_name: file.name })\n                .then(res => {\n                    fetchCarImages();\n                    window.location.reload();               \n                 })\n                .catch(error => {\n                    console.error(error);\n                })\n        }).catch(err => {\n            console.error(err)\n        });\n    }\n    function handleSubmitUploaderFixDocuments(e) {\n        e.preventDefault()\n        // Create file ref (Example: /documents/:car_id/:file_name)\n        const fileRef = imagesRef.child(`${props.carFix.id}/${file.name}`)\n        // Upload file\n        fileRef.put(file).then((snapshot) => {\n            // console.log('Upload success!', snapshot.constructor, snapshot);\n            axiosWithAuth().post(`/car_fix/${props.carFix.id}/car_fix_images`, { file_name: file.name })\n                .then(res => {\n                    fetchFixDocuments();\n                    window.location.reload();               \n                 })\n                .catch(error => {\n                    console.error(error);\n                })\n        }).catch(err => {\n            console.error(err)\n        });\n    }\n    \n\n\n    if(carImages.length > 0 ){\n        return (\n        <>\n                    {carImages.map((image, index) => {\n                        return <CarImgShow key={index} car={props.car} image={image}/>\n                    })} \n        </>\n        )\n    } else if(carFixImages.length > 0 ){\n        return (\n        <>\n                    {carFixImages.map((image, index) => {\n                        return <CarImageFixShow  key={index}  carFix={props.carFix} image={image}/>\n                    })} \n        </>\n        )\n    }else{\n        return (\n            <>\n                <div style={{height:\"200px\"}}>\n                {(props.car ? <DriveEtaIcon style={{fontSize:\"100px\"}}/> : null)} \n                <div style={{display:'flex',flexDirection:\"column\"}}>\n                 <form onSubmit={(props.car ? handleSubmitUploader : handleSubmitUploaderFixDocuments)}> \n                <input required id=\"uploader\" type=\"file\" accept=\"image/*,.pdf,.doc\" onChange={handleInputChanges}></input>\n                    <Button\n                    variant=\"contained\"\n                    name=\"car_type\"\n                    color=\"default\"\n                    className={classes.button}\n                    startIcon={<CloudUploadIcon />}\n                    type =\"submit\"\n                    >\n                    Upload\n                </Button>\n                </form>\n                </div>\n                </div>\n                \n            </>\n        )\n    }\n   \n        \n    \n}\n\n\n\nexport default CarImgUpload;\n"]},"metadata":{},"sourceType":"module"}